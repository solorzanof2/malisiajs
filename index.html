<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malisia JS</title>

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>

<body>
    <main class="mt-5">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="form-group">
                        <input type="text" name="text" id="input-text" class="form-control" data-mls-id="inputText">
                    </div>
                </div>
                <div class="col-12">
                    <small class="text-muted">Aquí debería mostrarse un título.</small>
                    <h4 data-mls-id="titleHolder"></h4>
                </div>
                <div class="col-12">
                    <button class="btn btn-info" data-mls-id="buttonTest" @click="mlsEvent">Click me!</button>
                </div>
                <div class="col-12 mt-3">
                    <button class="btn btn-info" data-mls-group="buttonTest2">Click by dataset</button>
                    <button class="btn btn-info" data-mls-group="buttonTest2">Click by dataset</button>
                    <button class="btn btn-info" data-mls-group="buttonTest2">Click by dataset</button>
                </div>
                <div class="col-12 mt-3">
                    <div class="form-control">
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 1
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 2
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 3
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 4
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 5
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 6
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 7
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 8
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 9
                        </label>
                        <label>
                            <input type="radio" name="radio-test" data-mls-group="radioTest"> radio 10
                        </label>
                    </div>
                </div>
                <div class="col-12 mt-3">
                    <input type="text" id="input-result" class="form-control" readonly mls-model="inputValue">
                </div>
                <div class="col-12 mt-3">
                    <p class="text-muted mb-0">
                        <small>Data Binded Result is:</small>
                    </p>
                    <h4 class="mb-0" mls-bind>{inputValue}</h4>
                </div>
                <div class="col-12 mt-3">
                    <p class="text-muted mb-0">
                        <small>Input two way Binding Result is:</small>
                    </p>
                    <div class="form-group">
                        <input type="text" class="form-control" mls-model="inputValue">
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script src="src/malisia.js"></script>
    <script>
        (() => {   

            const malisia = useMalisia();
            console.log(malisia);

            // malisia.inputText.value = "Hello World!";

            // ****** Funcionó OK......
            malisia.buttonTest.onclick = function() {
                // debugger;
                // Malisia.titleHolder.textContent = "hahahahaha no juega la vaina...";
                malisia.store.dispatch(Actions.updateValue, Malisia.inputText.value);
            }

            // ****** Funcionó OK......
            // Malisia.click(Malisia.buttonTest, () => {
            //     Malisia.titleHolder.textContent = "hahahahaha no juega la vaina...";
            // });

            const state = {
                inputValue: 'move for me, move for me, move for me!'
            }

            const reducer = {
                updateValue: (state, value) => {
                    // state.inputValue = `${state.inputValue} ${value}`;
                    state.inputValue = value;
                    return state;
                }
            }

            malisia.createStore('store', { initialState: state, mutations: reducer });
            const Actions = malisia.store.getActions();

            malisia.store.subscribe(Actions.updateValue, state => {
                malisia.titleHolder.textContent = state.inputValue;
            });

            // malisia.buttonTest.addEventListener('click', () => {
            //     malisia.store.dispatch(Actions.updateValue, Malisia.inputText.value);
            // });

            // funcionó OK...
            // Array.from(document.querySelectorAll('[data-mls-id="buttonTest2"]')).map(element => {
            //     element.addEventListener('click', function () {
            //         console.log({ message: 'Qué taaaaaaalllll.' });
            //     });
            // });

            //#region EVENT DELEGATOR
            // const clickEventHandler = (event) => {
            //     event = event || window.event;
            //     event.target = event.target || event.srcElement;

            //     let element = event.target;

            //     while (element) {
            //         if (element.nodeName === 'BUTTON' && /buttonTest2/.test(element.dataset.mlsId)) {
            //             testMethod();
            //             break;
            //         }

            //         element = element.parentNode;
            //     }
            // }
            
            // document.addEventListener('click', clickEventHandler, false);
            //#endregion EVENT DELEGATOR

            const testMethod = () => {
                console.log("Hello World!");
            }

            malisia.radioTest.on('change', function () {
                console.log(malisia.store.getState());
            });

            malisia.buttonTest2.on('click', function () {
                console.log({ control: 'button' });
            });

            malisia.inputText.oninput = function () {
                malisia.store.dispatch(Actions.updateValue, this.value);
            }
        })();
    </script>
</body>

</html>